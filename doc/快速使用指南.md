# BFT4Agent Simple Demo - 快速使用指南

## 🚀 5分钟上手

### Step 1: 安装依赖（1分钟）
```bash
pip install pyyaml pandas matplotlib
```

### Step 2: 运行Demo（1分钟）
```bash
cd bft4agent-simple
python main.py
```

### Step 3: 查看结果（1分钟）
观察输出，关注：
- ✅ **任务成功率**: 应该 > 60%
- ✅ **平均延迟**: 应该 < 5秒
- ✅ **视图切换**: 应该 < 5次

### Step 4: 修改配置（2分钟）
编辑`config.py`:
```python
CONFIG = {
    "num_agents": 13,  # 改为13个Agent
    "malicious_ratio": 0.2,  # 20%恶意节点
    # ... 其他配置
}
```

重新运行观察差异！

---

## 🧪 快速实验

### 实验1: 不同恶意节点比例
```python
# 创建 test_malicious.py
from main import *

configs = [
    (7, 0.0),   # 0% 恶意
    (7, 0.14),  # 14% 恶意
    (7, 0.2),   # 20% 恶意
    (9, 0.33),  # 33% 恶意
]

for num_agents, ratio in configs:
    config = load_config()
    config["num_agents"] = num_agents
    config["malicious_ratio"] = ratio

    # 运行实验（需要修改main.py支持参数）
    # results = run_experiment(config)
    # print(f"Agents: {num_agents}, Malicious: {ratio}, Success: {results['success_rate']}")
```

### 实验2: 不同网络延迟
```python
delays = [
    (10, 50),    # 低延迟
    (50, 200),   # 中延迟
    (200, 500),  # 高延迟
]

for min_delay, max_delay in delays:
    config = load_config()
    config["network_delay"] = (min_delay, max_delay)
    # 运行实验
```

---

## 📊 数据收集

### 手动记录
运行Demo时，记录以下数据：
```
任务序号 | 成功/失败 | 用时 | 视图切换 | 答案正确性
   1    |   成功   | 2.3s |    0    |    ✓
   2    |   成功   | 1.7s |    0    |    ✓
   3    |   失败   | 6.7s |    3    |    ✗
```

### 自动导出（待实现）
```python
# 在main.py最后添加
import pandas as pd

df = pd.DataFrame(results)
df.to_csv("data/results/experiment_1.csv", index=False)
print("Results saved to data/results/experiment_1.csv")
```

---

## 🔧 常见问题

### Q1: 为什么任务3失败了？
**A**: Mock LLM对除法问题的验证逻辑有bug。可以：
- 忽略这个任务
- 改进llm.py的`_solve_math()`方法
- 使用真实OpenAI API

### Q2: 如何使用真实LLM？
**A**: 修改config.py:
```python
CONFIG["llm_backend"] = "openai"
# 需要设置API key
```

### Q3: 如何添加更多测试任务？
**A**: 编辑`data/tasks/math_tasks.json`，添加新任务：
```json
{
  "task_id": "math_011",
  "content": "你的问题",
  "type": "math",
  "ground_truth": "答案"
}
```

---

## 📈 论文实验建议

### 最小实验集（1周内完成）
1. **基准测试**: 7个Agent，0%恶意，10个任务
2. **恶意测试**: 7个Agent，14%恶意，10个任务
3. **延迟测试**: 7个Agent，0%恶意，高延迟，10个任务

### 完整实验集（2-3周）
1. **恶意节点影响**: 0%, 10%, 20%, 33% × 10任务
2. **网络延迟影响**: 低/中/高延迟 × 10任务
3. **节点规模测试**: 7, 13, 21个Agent × 10任务

**总计**: 约100-150次任务执行

---

## 🎯 成功标准

Demo能够用于论文实验，如果：
- ✅ 能运行完整BFT流程
- ✅ 能收集延迟数据
- ✅ 能计算准确率
- ✅ 能测试不同配置
- ✅ 能导出实验数据

**当前状态**: ✅ **全部满足！**

---

**下一步**: 开始你的第一次实验！
**文档版本**: v1.0
**最后更新**: 2025-01-20
